<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Independent Scaffolding Calculator (Replica)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      margin: 0;
      padding: 16px;
      background: #f5f5f7;
      color: #111827;
    }
    h1, h2, h3 {
      margin-top: 0;
    }
    .container {
      max-width: 1100px;
      margin: 0 auto;
    }
    .card {
      background: #ffffff;
      border-radius: 16px;
      padding: 16px 20px;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.08);
      margin-bottom: 16px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px;
    }
    label {
      font-size: 13px;
      font-weight: 600;
      color: #4b5563;
      display: block;
      margin-bottom: 4px;
    }
    input {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      font-size: 14px;
      outline: none;
      background: #f9fafb;
    }
    input:focus {
      border-color: #2563eb;
      background: #ffffff;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.3);
    }
    .btn {
      display: inline-block;
      padding: 10px 18px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      background: #111827;
      color: #ffffff;
      margin-top: 8px;
    }
    .btn:active {
      transform: scale(0.98);
    }
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 12px;
      margin-top: 8px;
    }
    .summary-item {
      padding: 10px 12px;
      border-radius: 12px;
      background: #f3f4f6;
    }
    .summary-label {
      font-size: 12px;
      color: #6b7280;
    }
    .summary-value {
      font-size: 16px;
      font-weight: 700;
      margin-top: 4px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
      font-size: 13px;
    }
    th, td {
      border-bottom: 1px solid #e5e7eb;
      padding: 6px 8px;
      text-align: left;
    }
    th {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.03em;
      color: #6b7280;
      background: #f9fafb;
    }
    tr:nth-child(even) td {
      background: #fafafa;
    }
    .right {
      text-align: right;
    }
    .error {
      color: #b91c1c;
      font-size: 13px;
      margin-top: 6px;
    }
    .muted {
      font-size: 12px;
      color: #6b7280;
    }
    canvas {
      border-radius: 12px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
    }
    @media (max-width: 640px) {
      body {
        padding: 8px;
      }
      .card {
        padding: 12px 14px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Independent Scaffolding Calculator – Web Replica</h1>
    <p class="muted">
      Inputs: <strong>Height, Length, Width</strong> (same core inputs as your Excel).
      Outputs: <strong>manpower</strong>, <strong>material lengths & quantities</strong>,
      <strong>loading / SWL</strong>, and a conceptual scaffold sketch.
      This follows the logic style of your sheet, but fixes the broken formulas.
    </p>

    <!-- INPUT CARD -->
    <div class="card">
      <h2>Inputs</h2>
      <div class="grid">
        <div>
          <label for="height">Height (m)</label>
          <input type="number" id="height" step="0.01" value="3" />
        </div>
        <div>
          <label for="length">Length (m)</label>
          <input type="number" id="length" step="0.01" value="6" />
        </div>
        <div>
          <label for="width">Width (m)</label>
          <input type="number" id="width" step="0.01" value="1.8" />
        </div>
      </div>
      <button class="btn" id="calcBtn">Calculate</button>
      <div id="error" class="error"></div>
    </div>

    <!-- SUMMARY CARD -->
    <div class="card">
      <h2>Overall Summary</h2>
      <div class="summary-grid">
        <div class="summary-item">
          <div class="summary-label">Scaffold Volume (≈ B9×B10×B11)</div>
          <div class="summary-value" id="scafVolume">– m³</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Platform Area (≈ B10×B11)</div>
          <div class="summary-value" id="platformArea">– m²</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">No. of Lifts</div>
          <div class="summary-value" id="liftsOut">–</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">No. of Bays</div>
          <div class="summary-value" id="baysOut">–</div>
        </div>
      </div>
    </div>

    <!-- MANPOWER CARD -->
    <div class="card">
      <h2>Manpower (Work-face Hours)</h2>
      <div class="summary-grid">
        <div class="summary-item">
          <div class="summary-label">Work-face Area (Height × Length)</div>
          <div class="summary-value" id="workFaceArea">– m²</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Total Man-hours (Erect + Dismantle)</div>
          <div class="summary-value" id="manHours">– h</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Workers for 1 day (8 h)</div>
          <div class="summary-value" id="workersDay">– workers</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Time with 4 workers</div>
          <div class="summary-value" id="timeCrew">– h</div>
        </div>
      </div>
      <p class="muted" style="margin-top:8px;">
        Uses a height factor similar to cell <code>I31</code> in your sheet (more height ⇒
        more hours), and a work-face-based norm. You can tune the constants in the code if
        you want to exactly match your company’s agreed norms.
      </p>
    </div>

    <!-- MATERIAL CARD -->
    <div class="card">
      <h2>Material List (length & quantity)</h2>
      <table>
        <thead>
          <tr>
            <th>Material</th>
            <th>Unit</th>
            <th class="right">Piece Length (m)</th>
            <th class="right">Quantity</th>
            <th class="right">Total Length (m)</th>
          </tr>
        </thead>
        <tbody id="materialBody">
        </tbody>
      </table>
      <p class="muted">
        Geometry and items reflect the same idea as your Excel:
        independent scaffold with 2 rows of standards, bay spacing ≈ 2.0 m,
        lift spacing ≈ 2.0 m, one boarded / working lift, and distinct
        <strong>top rails</strong> and <strong>mid rails</strong>.
      </p>
    </div>

    <!-- LOADING CARD -->
    <div class="card">
      <h2>Loading & Safe Working Load</h2>
      <div class="summary-grid">
        <div class="summary-item">
          <div class="summary-label">Platform Area</div>
          <div class="summary-value" id="swlArea">– m²</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Design Load Category</div>
          <div class="summary-value" id="loadCategory">Medium duty</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Safe Load per m² (like B16)</div>
          <div class="summary-value" id="swlPerM2">2.0 kN/m²</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Total Safe Working Load</div>
          <div class="summary-value" id="swlTotal">–</div>
        </div>
      </div>
      <p class="muted" style="margin-top:8px;">
        Uses 2.0 kN/m² (~200 kg/m²) as a typical medium-duty value, similar to the
        live load in your Excel. Always check with codes and a competent engineer.
      </p>
    </div>

    <!-- SKETCH CARD -->
    <div class="card">
      <h2>Conceptual Sketch of Independent Scaffold</h2>
      <p class="muted">
        Not to scale. Shows bays (length direction) and lifts (height direction)
        similar to the sketch block in your sheet.
      </p>
      <canvas id="sketch" width="800" height="260"></canvas>
    </div>
  </div>

  <script>
    function formatNumber(n, digits = 0) {
      if (!Number.isFinite(n)) return "–";
      return n.toLocaleString(undefined, {
        minimumFractionDigits: digits,
        maximumFractionDigits: digits,
      });
    }

    function ceilSafe(x) {
      return Math.max(1, Math.ceil(Number.isFinite(x) ? x : 0));
    }

    // Approx height factor like I31: higher scaffolds get a multiplier
    function heightFactor(h) {
      if (h > 16) return 1.4;
      if (h > 12) return 1.3;
      if (h > 8)  return 1.2;
      if (h > 4)  return 1.1;
      return 1.0;
    }

    function calculate() {
      const errEl = document.getElementById("error");
      errEl.textContent = "";

      const h = parseFloat(document.getElementById("height").value);
      const l = parseFloat(document.getElementById("length").value);
      const w = parseFloat(document.getElementById("width").value);

      if (!h || !l || !w || h <= 0 || l <= 0 || w <= 0) {
        errEl.textContent = "Please enter valid positive values for height, length and width.";
        return;
      }

      // ---------- BASIC GEOMETRY (matches spirit of B9, B10, B11, B18) ----------
      const targetBay = 2.0;    // ~2 m bays along length
      const targetLift = 2.0;   // ~2 m lifts in height

      const bays = ceilSafe(l / targetBay);
      const lifts = ceilSafe(h / targetLift);

      const bayLen = l / bays;
      const liftHt = h / lifts;

      const scafVolume = h * l * w;     // similar to C20
      const platformArea = l * w;       // platform deck area
      const workFaceArea = h * l;       // "face" area

      document.getElementById("scafVolume").textContent =
        formatNumber(scafVolume, 2) + " m³";
      document.getElementById("platformArea").textContent =
        formatNumber(platformArea, 2) + " m²";
      document.getElementById("liftsOut").textContent = formatNumber(lifts);
      document.getElementById("baysOut").textContent = formatNumber(bays);

      // ---------- MANPOWER (work-face hours, using height factor) ----------
      // This is a repaired version of what your sheet tries to do:
      // base man-hours per m² for erection + dismantle, scaled by height factor.
      const baseErectPerM2 = 0.35;     // h/m² (erection)
      const baseDismantlePerM2 = 0.35; // h/m² (dismantle)
      const hf = heightFactor(h);

      const manHours = hf * workFaceArea * (baseErectPerM2 + baseDismantlePerM2);
      const workersForOneDay = Math.max(1, Math.ceil(manHours / 8)); // 8 h day
      const crewSize = 4;
      const timeWithCrewHours = manHours / crewSize;

      document.getElementById("workFaceArea").textContent =
        formatNumber(workFaceArea, 2) + " m²";
      document.getElementById("manHours").textContent =
        formatNumber(manHours, 2) + " h";
      document.getElementById("workersDay").textContent =
        formatNumber(workersForOneDay);
      document.getElementById("timeCrew").textContent =
        formatNumber(timeWithCrewHours, 2) + " h";

      // ---------- MATERIALS (same kind of items as in your DECK INDEPENDENT sheet) ----------
      const rows = 2;          // inner + outer line of standards
      const boardedLifts = 1;  // one working lift (like a single deck)

      // Standards – vertical tubes
      const standardsQty = (bays + 1) * rows;
      const standardsLen = h;

      // Ledgers – along length at each lift
      const ledgersQty = bays * rows * lifts;
      const ledgersLen = bayLen;

      // Transoms – across width at each lift
      const transomsQty = bays * lifts;
      const transomsLen = w;

      // Extra deck transoms (to limit board span) – approx every 1.2 m
      const extraTransomsPerBayPerLift = Math.max(1, Math.ceil(bayLen / 1.2));
      const extraTransomsQty = bays * lifts * extraTransomsPerBayPerLift;
      const extraTransomsLen = w;

      // Braces – diagonal along length
      const ledgerBracesQty = Math.max(2, Math.ceil(bays / 3) * rows);
      const ledgerBraceLen = Math.sqrt(bayLen * bayLen + liftHt * liftHt);

      // Braces – diagonal across width
      const transomBracesQty = Math.max(2, Math.ceil(lifts / 2) * rows);
      const transomBraceLen = Math.sqrt(w * w + liftHt * liftHt);

      // Deck boards – assume 225 mm wide, along length
      const boardWidth = 0.225;
      const boardsAcross = Math.max(1, Math.ceil(w / boardWidth));
      const deckBoardsQty = boardsAcross * bays * boardedLifts;
      const deckBoardLen = bayLen;

      // Toe boards – both sides
      const toeBoardsQty = bays * 2;
      const toeBoardLen = bayLen;

      // Guard rails – top & mid, along length & width on working lift
      const topRailsLenSide = bayLen; // along length
      const midRailsLenSide = bayLen;
      const topRailsLenEnd = w;       // along width
      const midRailsLenEnd = w;

      const topRailsQtyLength = bays * rows * boardedLifts; // inner + outer
      const midRailsQtyLength = topRailsQtyLength;

      const topRailsQtyWidth = 2 * boardedLifts; // both ends
      const midRailsQtyWidth = topRailsQtyWidth;

      // Base plates / jacks
      const basePlatesQty = standardsQty;

      const materials = [
        {
          name: "Standards (vertical tubes)",
          unit: "No.",
          pieceLength: standardsLen,
          quantity: standardsQty,
        },
        {
          name: "Ledgers (along length)",
          unit: "No.",
          pieceLength: ledgersLen,
          quantity: ledgersQty,
        },
        {
          name: "Transoms (across width)",
          unit: "No.",
          pieceLength: transomsLen,
          quantity: transomsQty,
        },
        {
          name: "Extra deck transoms",
          unit: "No.",
          pieceLength: extraTransomsLen,
          quantity: extraTransomsQty,
        },
        {
          name: "Ledger braces (diagonal lengthwise)",
          unit: "No.",
          pieceLength: ledgerBraceLen,
          quantity: ledgerBracesQty,
        },
        {
          name: "Transom braces (diagonal widthwise)",
          unit: "No.",
          pieceLength: transomBraceLen,
          quantity: transomBracesQty,
        },
        {
          name: "Decking boards",
          unit: "No.",
          pieceLength: deckBoardLen,
          quantity: deckBoardsQty,
        },
        {
          name: "Toe boards",
          unit: "No.",
          pieceLength: toeBoardLen,
          quantity: toeBoardsQty,
        },
        {
          name: "Top rails (length sides)",
          unit: "No.",
          pieceLength: topRailsLenSide,
          quantity: topRailsQtyLength,
        },
        {
          name: "Mid rails (length sides)",
          unit: "No.",
          pieceLength: midRailsLenSide,
          quantity: midRailsQtyLength,
        },
        {
          name: "Top rails (width sides)",
          unit: "No.",
          pieceLength: topRailsLenEnd,
          quantity: topRailsQtyWidth,
        },
        {
          name: "Mid rails (width sides)",
          unit: "No.",
          pieceLength: midRailsLenEnd,
          quantity: midRailsQtyWidth,
        },
        {
          name: "Base plates / jacks",
          unit: "No.",
          pieceLength: 0,
          quantity: basePlatesQty,
        },
      ];

      const tbody = document.getElementById("materialBody");
      tbody.innerHTML = "";
      materials.forEach(row => {
        const tr = document.createElement("tr");

        const tdName = document.createElement("td");
        tdName.textContent = row.name;

        const tdUnit = document.createElement("td");
        tdUnit.textContent = row.unit;

        const tdPiece = document.createElement("td");
        tdPiece.className = "right";
        tdPiece.textContent =
          row.pieceLength > 0 ? formatNumber(row.pieceLength, 2) : "–";

        const tdQty = document.createElement("td");
        tdQty.className = "right";
        tdQty.textContent = formatNumber(row.quantity);

        const tdTotalLen = document.createElement("td");
        tdTotalLen.className = "right";
        const totalLen =
          row.pieceLength > 0 ? row.pieceLength * row.quantity : 0;
        tdTotalLen.textContent =
          row.pieceLength > 0 ? formatNumber(totalLen, 2) : "–";

        tr.appendChild(tdName);
        tr.appendChild(tdUnit);
        tr.appendChild(tdPiece);
        tr.appendChild(tdQty);
        tr.appendChild(tdTotalLen);
        tbody.appendChild(tr);
      });

      // ---------- LOADING / SWL ----------
      const designLoad = 2.0; // kN/m², like your sheet's live load cell
      const totalSWL_kN = designLoad * platformArea;
      const totalSWL_kg = totalSWL_kN * 100; // 1 kN ≈ 100 kg

      document.getElementById("swlArea").textContent =
        formatNumber(platformArea, 2) + " m²";
      document.getElementById("swlPerM2").textContent =
        formatNumber(designLoad, 1) + " kN/m²";
      document.getElementById("swlTotal").textContent =
        formatNumber(totalSWL_kN, 2) + " kN (" +
        formatNumber(totalSWL_kg, 0) + " kg)";

      // ---------- SKETCH ----------
      drawSketch(bays, lifts, l, h, w);
    }

    function drawSketch(bays, lifts, length, height, width) {
      const canvas = document.getElementById("sketch");
      const ctx = canvas.getContext("2d");
      const wCanvas = canvas.width;
      const hCanvas = canvas.height;

      ctx.clearRect(0, 0, wCanvas, hCanvas);

      const margin = 40;
      const gridWidth = wCanvas - margin * 2;
      const gridHeight = hCanvas - margin * 2 - 40;

      const baySpacingPx = gridWidth / bays;
      const liftSpacingPx = gridHeight / lifts;

      ctx.lineWidth = 1;

      // Draw vertical standards
      ctx.strokeStyle = "#4b5563";
      for (let i = 0; i <= bays; i++) {
        const x = margin + i * baySpacingPx;
        ctx.beginPath();
        ctx.moveTo(x, margin);
        ctx.lineTo(x, margin + gridHeight);
        ctx.stroke();
      }

      // Draw horizontal lifts
      for (let j = 0; j <= lifts; j++) {
        const y = margin + j * liftSpacingPx;
        ctx.beginPath();
        ctx.moveTo(margin, y);
        ctx.lineTo(margin + gridWidth, y);
        ctx.stroke();
      }

      // Highlight platform (top working lift)
      ctx.fillStyle = "rgba(37, 99, 235, 0.18)";
      const platformY = margin + (lifts - 1) * liftSpacingPx;
      ctx.fillRect(margin, platformY, gridWidth, liftSpacingPx / 2);

      // Labels
      ctx.fillStyle = "#111827";
      ctx.font = "12px system-ui";
      ctx.fillText(`BAYS = ${bays}`, margin, margin - 10);
      ctx.fillText(`LIFTS = ${lifts}`, margin + gridWidth - 80, margin - 10);

      ctx.fillText(`Height ≈ ${height.toFixed(2)} m`, margin, margin + gridHeight + 16);
      ctx.fillText(`Length ≈ ${length.toFixed(2)} m`, margin, margin + gridHeight + 32);
      ctx.fillText(`Width ≈ ${width.toFixed(2)} m (into page)`, margin, margin + gridHeight + 48);

      ctx.font = "11px system-ui";
      ctx.fillText("Conceptual sketch of Independent Scaffold – Not to Scale", margin, hCanvas - 10);
    }

    document.getElementById("calcBtn").addEventListener("click", calculate);
    window.addEventListener("load", calculate);
  </script>
</body>
</html>
